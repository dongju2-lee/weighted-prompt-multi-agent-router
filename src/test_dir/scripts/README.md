# 가중치 테스트 스크립트 모음

멀티 에이전트 라우터의 가중치 제어 기능을 종합적으로 테스트하는 스크립트 모음입니다.

## 📋 스크립트 목록

### 1. 🌱 `seed_data_generator.sh`
**시드 데이터 생성 스크립트**

모든 에이전트가 최소 1번씩 선택되도록 강제로 시드 데이터를 생성합니다.

```bash
bash seed_data_generator.sh
```

**목적:** 
- 0 × 가중치 = 0 문제 해결
- 모든 에이전트가 기본 선택 히스토리를 보유하도록 보장

**결과:**
- 각 에이전트 1회씩 선택 완료
- 균등한 초기 라우팅 상태 구축

---

### 2. 📈 `gradual_weight_test.sh`
**점진적 가중치 증가 테스트**

특정 에이전트의 가중치를 점진적으로 증가시켜 라우팅 패턴 변화를 관찰합니다.

```bash
bash gradual_weight_test.sh
```

**테스트 단계:**
- 가중치: 1.0 → 1.5 → 2.0 → 3.0 → 5.0
- 각 단계마다 15회 테스트 실행
- 대상 에이전트: 야구_에이전트 (스크립트 내에서 변경 가능)

**결과 파일:**
- `target_agent_progression.csv`: 가중치별 선택률 진행 데이터
- 각 단계별 상세 결과 디렉토리

---

### 3. 💥 `sudden_drop_test.sh`
**급격한 가중치 감소 테스트**

주도권을 가진 에이전트의 가중치를 급격히 낮춰서 라우팅 전환을 확인합니다.

```bash
bash sudden_drop_test.sh
```

**테스트 시나리오:**
1. **Phase 1:** 농구 에이전트 주도권 확립 (가중치 5.0)
2. **Phase 2:** 농구 에이전트 급격 감소 (가중치 0.1)
3. **Phase 3:** 축구 에이전트 부스트 (가중치 5.0)
4. **Phase 4:** 극단적 전환 (축구 0.01, 테니스 10.0)

**각 단계마다 20회 테스트**

---

### 4. 🔄 `sequential_control_test.sh`
**순차적 에이전트 제어 테스트**

각 에이전트가 순차적으로 주도권을 가지도록 제어합니다.

```bash
bash sequential_control_test.sh
```

**제어 방식:**
- 대상 에이전트: 가중치 8.0
- 나머지 에이전트: 가중치 0.5
- 각 에이전트당 25회 테스트

**결과 파일:**
- `control_effectiveness.csv`: 에이전트별 제어 효과 데이터

---

### 5. ⚔️ `competition_test.sh`
**경쟁 상황 테스트**

여러 에이전트 간 가중치 경쟁 상황에서의 라우팅 분배를 테스트합니다.

```bash
bash competition_test.sh
```

**경쟁 시나리오:**
1. 축구 vs 농구 동일 가중치 (각 3.0)
2. 축구 vs 농구 미세한 차이 (3.0 vs 2.8)
3. 3자 경쟁 (축구, 농구, 야구 각 2.5)
4. 4자 균등 경쟁 (모두 2.0)
5. 야구 vs 테니스 고가중치 (각 5.0)
6. 계단식 가중치 (4.0, 3.0, 2.0, 1.0)

**각 시나리오마다 30회 테스트**

**결과 파일:**
- `competition_index.csv`: 시나리오별 경쟁 지수 데이터

---

### 6. 🔄 `realtime_multi_change_test.sh`
**실시간 다중 가중치 변경 테스트**

테스트 실행 중 실시간으로 가중치를 여러 번 변경하여 즉시 반영을 확인합니다.

```bash
bash realtime_multi_change_test.sh
```

**테스트 설정:**
- 총 100회 테스트
- 매 10회마다 가중치 변경
- 10가지 가중치 시나리오 순환

**가중치 시나리오:**
- 각 에이전트 우세 상황 (5.0 vs 1.0)
- 2자 경쟁 상황 (3.0 vs 3.0)
- 극단적 우세 (10.0 vs 0.1)
- 계단식 배치

**결과 파일:**
- `realtime_results.csv`: 테스트별 결과와 변경 시점
- `weight_changes.csv`: 가중치 변경 기록

---

### 7. 🚀 `run_all_weight_scenarios.sh`
**통합 실행 스크립트**

모든 가중치 테스트 시나리오를 순차적으로 실행하고 종합 분석을 수행합니다.

```bash
bash run_all_weight_scenarios.sh
```

**실행 순서:**
1. 시드 데이터 생성
2. 점진적 가중치 증가 테스트
3. 급격한 가중치 감소 테스트
4. 순차적 에이전트 제어 테스트
5. 경쟁 상황 테스트
6. 실시간 다중 가중치 변경 테스트

**결과:**
- 종합 결과 디렉토리 생성
- 테스트 성공/실패 통계
- 자동 결과 분석 실행

---

### 8. 📊 `analyze_all_results.py`
**종합 결과 분석 스크립트**

모든 테스트 결과를 분석하여 인사이트와 추천사항을 제공합니다.

```bash
python3 analyze_all_results.py <결과_디렉토리>
```

**분석 내용:**
- 가중치 효과성 지수 계산
- 에이전트별 제어 효과 분석
- 경쟁 상황 분석
- 실시간 반응성 평가
- 종합 인사이트 및 추천사항

**결과 파일:**
- `comprehensive_analysis.txt`: 종합 분석 보고서

---

## 🚦 사용 전 준비사항

### 1. API 서버 실행
```bash
cd /Users/idongju/dev/weighted-prompt-multi-agent-router
python -m run_dir.run_api
```

### 2. 스크립트 실행 권한 부여
```bash
chmod +x *.sh
```

### 3. Python 의존성 확인
- Python 3.x
- 표준 라이브러리 (json, csv, pathlib 등)

---

## 📁 결과 파일 구조

각 테스트는 타임스탬프가 포함된 고유한 디렉토리에 결과를 저장합니다:

```
test_name_YYYYMMDD_HHMMSS/
├── phase1/
│   ├── test_1.json
│   ├── test_2.json
│   └── ...
├── phase2/
│   └── ...
├── progression_data.csv    # 진행률 데이터
├── effectiveness_data.csv  # 효과성 데이터
└── routing_stats.json     # 라우팅 통계
```

---

## 🧪 테스트 시나리오 설명

### 핵심 문제 해결: 0 × 가중치 = 0
- **문제:** 과거 선택률이 0%인 에이전트는 가중치를 아무리 높여도 선택되지 않음
- **해결:** 시드 데이터 생성으로 모든 에이전트 최소 1회 선택 보장

### 가중치 제어 효과
- **점진적 증가:** 가중치 상승에 따른 선택률 증가 패턴 확인
- **급격한 변화:** 즉시적 라우팅 전환 능력 테스트
- **순차적 제어:** 각 에이전트 개별 제어 효과 측정

### 경쟁 상황 분석
- **동일 가중치:** 확률적 분배 확인
- **미세한 차이:** 작은 가중치 차이의 영향 분석
- **다자 경쟁:** 복잡한 경쟁 상황에서의 균형점 확인

### 실시간 반응성
- **즉시 반영:** 가중치 변경의 실시간 적용 확인
- **연속 변경:** 빈번한 변경에 대한 시스템 안정성
- **패턴 학습:** 변경 패턴에 대한 시스템 적응성

---

## 💡 주요 인사이트

### 1. 효과적인 가중치 비율
- **극단적 비율:** 10.0 vs 0.1로 명확한 제어 가능
- **적절한 비율:** 3.0 vs 1.0으로 부드러운 제어
- **경쟁 비율:** 3.0 vs 2.8로 균형잡힌 경쟁

### 2. 제어 전략
- **강력한 제어:** 대상 8.0, 나머지 0.5
- **부드러운 제어:** 대상 3.0, 나머지 1.0
- **경쟁 유도:** 유사한 높은 가중치 설정

### 3. 시스템 특성
- **즉시 반영:** 가중치 변경 후 다음 요청부터 적용
- **확률적 분배:** 동일 가중치에서 무작위 분배
- **히스토리 의존:** 과거 선택률이 현재 확률에 영향

---

## 🔧 문제 해결

### API 서버 연결 실패
```bash
# 서버 상태 확인
curl http://localhost:8000/routing-stats

# 서버 재시작
cd /Users/idongju/dev/weighted-prompt-multi-agent-router
python -m run_dir.run_api
```

### 시드 데이터 부족
```bash
# 수동 시드 데이터 생성
bash seed_data_generator.sh
```

### 권한 오류
```bash
# 실행 권한 부여
chmod +x *.sh
```

---

## 📞 문의 및 지원

테스트 관련 문의사항이나 개선 제안은 프로젝트 관리자에게 문의하세요.

**마지막 업데이트:** 2025년 7월 8일 (종합 가중치 테스트 시스템 구축 완료) 