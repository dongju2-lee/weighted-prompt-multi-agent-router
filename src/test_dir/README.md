# 🏃 운동 추천 시스템 멀티프로세스 테스트

이 디렉토리는 운동 추천 시스템의 라우팅 성능을 대규모로 테스트하고 분석하는 도구들을 포함합니다.

## 📁 파일 구성

- `multi_test.sh`: 500번 멀티프로세스 테스트 실행 스크립트
- `analyze_results.py`: 테스트 결과 분석 및 리포트 생성 스크립트
- `README.md`: 사용법 설명서

## 🚀 사용법

### 1. API 서버 실행
먼저 운동 추천 API 서버가 실행 중이어야 합니다:
```bash
cd ../run_dir
python3 run_api.py
```

### 2. 테스트 실행
```bash
cd src/test_dir
./multi_test.sh
```

## ⚙️ 설정 옵션

`multi_test.sh` 스크립트에서 다음 설정을 변경할 수 있습니다:

```bash
API_URL="http://localhost:8000/sports-agent-route"  # API 엔드포인트
TEST_QUERY="심심해"                                 # 테스트할 질문
TOTAL_TESTS=500                                    # 총 테스트 횟수
CONCURRENT_JOBS=50                                 # 동시 실행 프로세스 수
```

## 📊 분석 결과

테스트 완료 후 `test_results_YYYYMMDD_HHMMSS` 디렉토리에 다음 파일들이 생성됩니다:

### 1. 개별 테스트 결과
- `test_1.json`, `test_2.json`, ... : 각 테스트의 상세 응답

### 2. 분석 리포트
- `analysis_report.md`: 상세한 분석 리포트 (마크다운)
- `analysis_data.json`: 분석 데이터 (JSON)

## 📈 분석 내용

### 핵심 분석 지표
1. **프롬프트 vs 실제 라우팅 비율 비교**
   - Gemini에게 제공된 가중치 적용 비율
   - 실제 선택된 에이전트 분포
   - 두 비율 간의 차이 및 차이율

2. **시스템 성능**
   - 성공률 및 실패율
   - 초당 처리량 (requests/sec)
   - 응답 시간 분석

3. **라우팅 정확도**
   - 각 에이전트별 선택 빈도
   - 가중치 설정의 효과 분석
   - Gemini 응답 패턴 분석

### 샘플 리포트 구조
```
# 🏃 운동 추천 시스템 라우팅 분석 리포트

## 📊 테스트 개요
- 테스트 질문: "심심해"
- 총 테스트 수: 500
- 성공률: 99.2%
- 실행 시간: 45초

## 🎯 라우팅 결과 분석
### 실제 라우팅 분포
- 테니스_에이전트: 145회 (29.0%)
- 축구_에이전트: 118회 (23.6%)
- ...

### 프롬프트 vs 실제 라우팅 비율 비교
| 에이전트 | 프롬프트 비율 | 실제 비율 | 차이 | 차이율 |
|---------|-------------|----------|------|--------|
| 테니스_에이전트 | 28.6% | 29.0% | +0.4% | +1.4% |
...

## 🤖 Gemini 응답 분석
(샘플 응답 및 패턴 분석)

## 📈 분석 결론
(권장사항 및 개선점)
```

## 🔧 고급 사용법

### 다른 질문으로 테스트
스크립트에서 `TEST_QUERY` 변수를 변경하여 다른 질문을 테스트할 수 있습니다:
```bash
TEST_QUERY="축구 하고 싶어"
TEST_QUERY="농구장 어디 있어?"
TEST_QUERY="운동 추천해줘"
```

### 성능 조정
- `CONCURRENT_JOBS`: 동시 실행 프로세스 수 조정 (시스템 성능에 따라)
- `TOTAL_TESTS`: 테스트 횟수 조정 (더 정확한 분석을 위해 증가 가능)

### 의존성
- `curl`: HTTP 요청을 위해 필요
- `python3`: 결과 분석을 위해 필요
- `parallel` (선택사항): 더 빠른 병렬 처리를 위해 설치 권장

## 💡 활용 예시

1. **A/B 테스트**: 다른 가중치 설정으로 여러 번 테스트하여 최적 설정 찾기
2. **성능 벤치마크**: 시스템 부하 테스트 및 처리량 측정
3. **라우팅 정확도 검증**: 예상 분포와 실제 분포 비교 분석
4. **질문별 라우팅 패턴 분석**: 다양한 질문에 대한 에이전트 선택 패턴 파악 